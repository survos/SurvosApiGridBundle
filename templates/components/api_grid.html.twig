{# templates/components/datatable.html.twig #}

{% set columns = this.normalizedColumns %}
{% set templates = [] %}
{#    {% if block(c.name) is defined %} #}
{#        {% set templates[c.name] = block(c.name) %} #}
{#        {% with {row: row} %} #}
{#            {{ block(c.name) }} #}
{#        {% endwith %} #}
{#    {% else %} #}
{#        {{ attribute(row, c.name)|default() }} #}
{#    {% endif %} #}

{# <code>{{ this.stimulusController }}</code> #}
{# {{ dump('sortable', sortable_fields(this.class)) }}#}

class: this.class,
searchBuilderFields: this.searchBuilderFields,
sortableFields: sortable_fields(this.class),
searchableFields: searchable_fields(this.class),

<div {{ stimulus_controller(this.stimulusController, {
    schema: schema,
    api_call:  this.apiGetCollectionUrl|default(this.class ? api_route(this.class) : 'meilisearch'),
    searchPanesDataUrl:  this.searchPanesDataUrl|default(null),
    locale: this.locale ?: (app.request.locale ?: 'xx'),
    columnConfiguration: columns|json_encode,
    dom: this.dom|default(false),
    index: this.index|default(false),
    pageLength: this.pageLength,
    filter: this.filter
}) }}>

    {% block modal %}
        {{ include('@SurvosGrid/_modal.html.twig', {
            formUrl: '/',
            aaController: this.stimulusController,
            modalController: 'modal-form',
            modalClass: 'modal-md',
            modalTitle: this.caller,
            buttonLabel: 'Show MODAL',
            modalContent: 'really should load with ajax'
        }) }}
    {% endblock %}


    <table class="table table-striped responsive" {{ stimulus_target(this.stimulusController, 'table') }}>
    </table>

</div>

